<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://kauri.io/collections/ConsenSys%20Projects/listening-to-ethereum-events-with-eventeum/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Listening to Ethereum Events with Eventeum - kauri.io</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Listening to Ethereum Events with Eventeum", url: "#_top", children: [
              {title: "What is Eventeum?", url: "#what-is-eventeum" },
              {title: "Prerequisites", url: "#prerequisites" },
              {title: "Deploying Eventeum", url: "#deploying-eventeum" },
              {title: "The Smart Contract", url: "#the-smart-contract" },
              {title: "Configuring Eventeum", url: "#configuring-eventeum" },
              {title: "Registering the NameAdded Event with Eventeum via REST", url: "#registering-the-nameadded-event-with-eventeum-via-rest" },
              {title: "Next Steps", url: "#next-steps" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-172017815-1', 'kauri.io');
        ga('send', 'pageview');
    </script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h1 id="listening-to-ethereum-events-with-eventeum">Listening to Ethereum Events with Eventeum<a class="headerlink" href="#listening-to-ethereum-events-with-eventeum" title="Permanent link"></a></h1>
<p><img alt="" src="https://ipfs.infura.io/ipfs/QmbU72Pp8ujDbJQS5yRyPZrLYEN7peQWBw3QwHZxU9ub41" /></p>
<h3 id="what-is-eventeum">What is Eventeum?<a class="headerlink" href="#what-is-eventeum" title="Permanent link"></a></h3>
<p>Eventeum is an Ethereum event listener service that provides a bridge between your smart contracts and middleware layer.  Events subscriptions can be registered dynamically, and on emission, a message containing the details of the event are broadcast onto a message bus (currently either Kafka or RabbitMQ) which can then be consumed by your backend services.</p>
<p>It was developed by the kauri.io team, and the source code is freely available under the Apache 2.0 license.  Click <a href="https://github.com/ConsenSys/eventeum/">here</a> to view the github repository.
<img alt="" src="https://ipfs.infura.io/ipfs/QmXqLJc3qp8vkHqifRCjbZApg758kdgBrgZVibkMDDFCqZ" />
Eventeum is:</p>
<ul>
<li>
<p>Highly Available - Eventeum services communicate with each other to ensure that every instance is subscribed to the same collection of smart contract events.</p>
</li>
<li>
<p>Resilient - Node failures are detected and event subscriptions will continue from the failure block once the node comes back online.</p>
</li>
<li>
<p>Fork Tolerant - Eventeum can be configured to wait a certain amount of blocks before an event is considered 'Confirmed'. If a fork occurs during this time, a message is broadcast to the network, allowing your services to react to the forked/removed event.</p>
</li>
</ul>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link"></a></h3>
<p>To follow this example, you must have the following installed on your system:</p>
<ul>
<li>Java 8</li>
<li>Maven</li>
<li>Docker</li>
</ul>
<h3 id="deploying-eventeum">Deploying Eventeum<a class="headerlink" href="#deploying-eventeum" title="Permanent link"></a></h3>
<p>Out of the box, Eventeum has dependencies on a number of external services, namely Kafka/Zookepper and MongoDB.  The easiest way to get an Eventeum instance running locally right now is to clone the repo from github and run the docker-compose script from the server folder.  This will automatically fire up all the dependant services, including a Parity node running in dev mode.</p>
<p><code>git clone https://github.com/ConsenSys/eventeum.git</code></p>
<p><code>cd eventeum</code></p>
<p><code>mvn clean package</code></p>
<p><code>cd server</code></p>
<p><code>docker compose build</code></p>
<p><code>docker compose up</code></p>
<h3 id="the-smart-contract">The Smart Contract<a class="headerlink" href="#the-smart-contract" title="Permanent link"></a></h3>
<p>For this example, we will use a very basic name registry smart contract, where anyone can add a name to the registry by calling a function.  An event is emitted whenever a name is added, and this will be picked up by Eventeum and broadcast to the backend service.</p>
<pre><code>pragma solidity ^0.4.24;

contract NamesRegistry {

    struct Name {
        string firstName;
        string surname;
    }

    Name[] names;

    function add(Name(string firstName, string surname)) external {
        names.pushName(firstName, surname);

        emit NameAdded(names.length - 1, firstName, surname);
    }

    event NameAdded(uint256 id, string firstName, string surname);
}
</code></pre>
<h4 id="deploying">Deploying<a class="headerlink" href="#deploying" title="Permanent link"></a></h4>
<p>We want to deploy our smart contract to the parity node that we started via docker, so open <a href="https://remix.ethereum.org">remix</a> and select the 'Web3 Provider' environment from the Run panel.</p>
<p><img alt="" src="https://ipfs.infura.io/ipfs/QmZtXWsmrcdznQ4xByD4dtV7Gv7VHVvcZaMs4XvbggdWVf" /></p>
<p>When prompted, keep the default http://localhost:8545 endpoint address.  You should now be connected to your local parity dev node with plenty of test eth to play around with in the default, unlocked account.</p>
<p>Next, we need to deploy our NamesRegistry smart contract to our Ethereum node so paste the above smart contract code into remix, compile and deploy.  Take a note of the deployed contract address, as we will need this when configuring Eventeum in the next step.</p>
<h3 id="configuring-eventeum">Configuring Eventeum<a class="headerlink" href="#configuring-eventeum" title="Permanent link"></a></h3>
<p>Now that our contract is deployed, we need to instruct Eventeum to listen for NameAdded events emitted from this contract.  There are currently 2 ways to do this:</p>
<ul>
<li>Properties File - Events that Eventeum should listen for can be configured in the <code>application.yml</code> file of Eventeum.</li>
<li>REST API - Events can be registered dynamically by send http requests to a REST endpoint.  This is the approach that we will use in this tutorial.</li>
</ul>
<h3 id="registering-the-nameadded-event-with-eventeum-via-rest">Registering the NameAdded Event with Eventeum via REST<a class="headerlink" href="#registering-the-nameadded-event-with-eventeum-via-rest" title="Permanent link"></a></h3>
<p>By default Eventeum listens on port 8060, and exposes a filter registration endpoint at <code>/api/rest/v1/event-filter</code>.  Paste the below curl request into a terminal, ensuring that the `CONTRACT_ADDRESS' is replaced by the address of the deployed NamesRegistry smart contract in the previous step.</p>
<pre><code>curl -X POST \
http://localhost:8060/api/rest/v1/event-filter \
-H 'Cache-Control: no-cache' \
-H 'Content-Type: application/json' \
-H 'Postman-Token: 616712a3-bf11-bbf5-b4ac-b82835779d51' \
-d '{
&quot;id&quot;: &quot;NameAddedEvent&quot;,
&quot;contractAddress&quot;: &quot;CONTRACT_ADDRESS&quot;,
&quot;eventSpecification&quot;: {
  &quot;eventName&quot;: &quot;NameAdded&quot;,
  &quot;nonIndexedParameterDefinitions&quot;: [
    {&quot;position&quot;: 0, &quot;type&quot;: &quot;UINT256&quot;},
    {&quot;position&quot;: 1, &quot;type&quot;: &quot;STRING&quot;},
    {&quot;position&quot;: 2, &quot;type&quot;: &quot;STRING&quot;}] }
}'
</code></pre>
<p>If everything went well, you should see a <code>registerContractEventFilter - Registering filter: {"id":"NameAddedEvent"...</code> log entry in the running Eventeum docker terminal.</p>
<blockquote>
<p>The body of the REST request defines the specification of the event that is to be registered.  Comparing to the smart contract definition of the event, we can see that it defines the event name, along with the type and order of each parameter.</p>
</blockquote>
<p>To test that Eventeum is correctly listening for events emitted from the deployed contract, try adding a name to the registry.</p>
<p><img alt="" src="https://ipfs.infura.io/ipfs/QmeMarJvXRoGjY8EFa8xrPUDNSjecSYhb9GUq92NbE879g" /></p>
<p>If everything is configured correctly, you should see a <code>broadcastContractEvent</code> entry in the Eventeum logs that looks similar to this:</p>
<pre><code>broadcastContractEvent - Sending message: {&quot;id&quot;:&quot;0x2553-0xd5b2-0&quot; ,&quot;type&quot;:&quot;CONTRACT_EVENT&quot;, &quot;details&quot;:
{&quot;name&quot;:&quot;NameAdded&quot;, &quot;filterId&quot;:&quot;NameAddedEvent&quot;, &quot;indexedParameters&quot;:[], &quot;nonIndexedParameters&quot;:
[{&quot;type&quot;:&quot;uint256&quot;,&quot;value&quot;:0},{&quot;type&quot;:&quot;string&quot;,&quot;value&quot;:&quot;Craig&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;value&quot;:&quot;Williams&quot;}], 
&quot;transactionHash&quot;:&quot;0x25539b1d3b92c2f61331d9972d48fe24cbbbe3b4da4a901ffd6ebd6514166f5d&quot;, &quot;logIndex&quot;:0, 
&quot;blockNumber&quot;:15, &quot;blockHash&quot;:&quot;0xd5b26e4fb8b390e45144632a4d75bdebfa841191a5ffb0d4e2971928357f13ec&quot;,
&quot;address&quot;:&quot;0xcd9a70c13c88863ece51b302a77d2eb98fbbbd65&quot;, &quot;status&quot;:&quot;UNCONFIRMED&quot;, 
&quot;eventSpecificationSignature&quot;:&quot;0x7b876012e0c37b7cd150df23c4d206b4cecc7d4a307d81bc6d921e08171687d6&quot;, 
&quot;networkName&quot;:&quot;&quot;, &quot;id&quot;:&quot;&quot;0x2553-0xd5b2-0&quot;&quot;}, &quot;retries&quot;:0}
</code></pre>
<p>Congratulations, if you see this message then this means that Eventeum has received notification of the event emission from our smart contract, and has pushed a corresponding CONTRACT_EVENT message onto our Kafka queue with all the details of the emitted event.  Pretty sweet!</p>
<h3 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link"></a></h3>
<p>Now that Eventeum is configured correctly, you are ready to <a href="https://kauri.io/article/fe81ee9612eb4e5a9ab72790ef24283d/using-eventeum-to-build-a-java-smart-contract-data-cache">build a service that consumes events from the Kafka topic, and perform some processing on these events.</a></p>
<p>To learn more about Eventeum API's, message specifications or advanced configuration, checkout the github page at: <a href="https://github.com/ConsenSys/eventeum/">https://github.com/ConsenSys/eventeum/</a>.</p>
<p>Lastly, Eventeum is fully open-source and we welcome community contributions, so feel free to play around with the application and modify it to your needs...just don't forget to create a pull request afterwards, to help improve the product!</p>
<hr />
<ul>
<li><strong>Kauri original title:</strong> Listening to Ethereum Events with Eventeum</li>
<li><strong>Kauri original link:</strong> https://kauri.io/listening-to-ethereum-events-with-eventeum/90dc8d911f1c43008c7d0dfa20bde298/a</li>
<li><strong>Kauri original author:</strong> Craig Williams (@craig)</li>
<li><strong>Kauri original Publication date:</strong> 2019-08-06</li>
<li><strong>Kauri original tags:</strong> eventeum, ethereum, web3, event-listener</li>
<li><strong>Kauri original hash:</strong> QmYWKGy1Cv41Ywf9TwzCy8f9fnSW5sSCLJne4rnxMkHVhX</li>
<li><strong>Kauri original checkpoint:</strong> QmRS3wCLX2MRi62bg9NTM89qNkgm3XjpKXciLvCKAr1f1g</li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../getting-started-with-mahuta-a-search-engine-for-t/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../getting-started-with-mahuta-a-search-engine-for-t/" class="btn btn-xs btn-link">
        Getting started with Mahuta - A Search engine for the IPFS
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../truffle-101-development-tools-for-smart-contracts/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../truffle-101-development-tools-for-smart-contracts/" class="btn btn-xs btn-link">
        Truffle 101 - Development Tools for Smart Contracts
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
      <p>
        <a href="https://github.com/kauri-io/archive/edit/main/docs/collections/ConsenSys Projects/listening-to-ethereum-events-with-eventeum.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>