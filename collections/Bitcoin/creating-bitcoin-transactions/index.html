<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://kauri.io/collections/Bitcoin/creating-bitcoin-transactions/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Creating Bitcoin Transactions - kauri.io</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Creating Bitcoin Transactions", url: "#_top", children: [
              {title: "Transactions", url: "#transactions" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-172017815-1', 'kauri.io');
        ga('send', 'pageview');
    </script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h1 id="creating-bitcoin-transactions">Creating Bitcoin Transactions<a class="headerlink" href="#creating-bitcoin-transactions" title="Permanent link"></a></h1>
<p><img alt="" src="https://ipfs.infura.io/ipfs/QmdgSUUciYeLe4q7a86LXjXXfbYcfNztXUYdV1uZyiy6oP" /></p>
<p><em>This article originally appeared on <a href="https://bitcoin.org/en/developer-examples#transaction-tutorial">bitcoin.org</a></em></p>
<h3 id="transactions">Transactions<a class="headerlink" href="#transactions" title="Permanent link"></a></h3>
<h4 id="transaction-tutorial">Transaction Tutorial<a class="headerlink" href="#transaction-tutorial" title="Permanent link"></a></h4>
<p>Creating transactions is something most Bitcoin applications do.
This section describes how to use Bitcoin Core's RPC interface to
create transactions with various attributes.</p>
<p>Your applications may use something besides Bitcoin Core to create
transactions, but in any system, you will need to provide the same kinds
of data to create transactions with the same attributes as those
described below.</p>
<p>In order to use this tutorial, you will need to setup [Bitcoin Core][https://bitcoin.org/en/download]
and create a regression test mode environment with 50 BTC in your test
wallet.</p>
<h5 id="simple-spending">Simple Spending<a class="headerlink" href="#simple-spending" title="Permanent link"></a></h5>
<p>Bitcoin Core provides several RPCs which handle all the details of
spending, including creating change outputs and paying appropriate fees.
Even advanced users should use these RPCs whenever possible to decrease
the chance that satoshis will be lost by mistake.</p>
<pre><code>&gt; bitcoin-cli -regtest getnewaddress
mvbnrCX3bg1cDRUu8pkecrvP6vQkSLDSou

&gt; NEW_ADDRESS=mvbnrCX3bg1cDRUu8pkecrvP6vQkSLDSou
</code></pre>
<p>Get a new Bitcoin address and save it in the shell variable <code>$NEW_ADDRESS</code>.</p>
<pre><code>&gt; bitcoin-cli -regtest sendtoaddress $NEW_ADDRESS 10.00
263c018582731ff54dc72c7d67e858c002ae298835501d80200f05753de0edf0
</code></pre>
<p>Send 10 bitcoins to the address using the <code>sendtoaddress</code> RPC.  The
returned hex string is the transaction identifier (txid).</p>
<p>The <code>sendtoaddress</code> RPC automatically selects an unspent transaction
output (UTXO) from which to spend the satoshis. In this case, it
withdrew the satoshis from our only available UTXO, the coinbase
transaction for block #1 which matured with the creation of block #101.
To spend a specific UTXO, you could use the <code>sendfrom</code> RPC instead.</p>
<pre><code>&gt; bitcoin-cli -regtest listunspent
[
]
</code></pre>
<p>Use the <code>listunspent</code> RPC to display the UTXOs belonging to this wallet.
The list is empty because it defaults to only showing confirmed
UTXOs and we just spent our only confirmed UTXO.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest listunspent 0
</code></pre>


<pre><code>[
    {
        &quot;txid&quot; : &quot;263c018582731ff54dc72c7d67e858c002ae298835501d\
                  80200f05753de0edf0&quot;,
        &quot;vout&quot; : 0,
        &quot;address&quot; : &quot;muhtvdmsnbQEPFuEmxcChX58fGvXaaUoVt&quot;,
        &quot;scriptPubKey&quot; : &quot;76a9149ba386253ea698158b6d34802bb9b550\
                          f5ce36dd88ac&quot;,
        &quot;amount&quot; : 40.00000000,
        &quot;confirmations&quot; : 0,
        &quot;spendable&quot; : true,
        &quot;solvable&quot; : true
    },
    {
        &quot;txid&quot; : &quot;263c018582731ff54dc72c7d67e858c002ae298835501d\
                  80200f05753de0edf0&quot;,
        &quot;vout&quot; : 1,
        &quot;address&quot; : &quot;mvbnrCX3bg1cDRUu8pkecrvP6vQkSLDSou&quot;,
        &quot;account&quot; : &quot;&quot;,
        &quot;scriptPubKey&quot; : &quot;76a914a57414e5ffae9ef5074bacbe10a320bb\
                          2614e1f388ac&quot;,
        &quot;amount&quot; : 10.00000000,
        &quot;confirmations&quot; : 0,
        &quot;spendable&quot; : true,
        &quot;solvable&quot; : true
    }
]
</code></pre>

</div>

<p>Re-running the <code>listunspent</code> RPC with the argument "0" to also display
unconfirmed transactions shows that we have two UTXOs, both with the
same txid. The first UTXO shown is a change output that <code>sendtoaddress</code>
created using a new address from the key pool. The second UTXO shown is
the spend to the address we provided. If we had spent those satoshis to
someone else, that second transaction would not be displayed in our
list of UTXOs.</p>
<pre><code>&gt; bitcoin-cli -regtest generate 1

&gt; unset NEW_ADDRESS
</code></pre>
<p>Create a new block to confirm the transaction above (takes less than a
second) and clear the shell variable.</p>
<h5 id="simple-raw-transaction">Simple Raw Transaction<a class="headerlink" href="#simple-raw-transaction" title="Permanent link"></a></h5>
<p>The raw transaction RPCs allow users to create custom transactions and
delay broadcasting those transactions. However, mistakes made in raw
transactions may not be detected by Bitcoin Core, and a number of raw
transaction users have permanently lost large numbers of satoshis, so
please be careful using raw transactions on mainnet.</p>
<p>This subsection covers one of the simplest possible raw transactions.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest listunspent
</code></pre>


<pre><code>[
    {
        &quot;txid&quot; : &quot;263c018582731ff54dc72c7d67e858c002ae298835501d\
                  80200f05753de0edf0&quot;,
        &quot;vout&quot; : 0,
        &quot;address&quot; : &quot;muhtvdmsnbQEPFuEmxcChX58fGvXaaUoVt&quot;,
        &quot;scriptPubKey&quot; : &quot;76a9149ba386253ea698158b6d34802bb9b550\
                          f5ce36dd88ac&quot;,
        &quot;amount&quot; : 40.00000000,
        &quot;confirmations&quot; : 1,
        &quot;spendable&quot; : true,
        &quot;solvable&quot; : true
    },
    {
        &quot;txid&quot; : &quot;263c018582731ff54dc72c7d67e858c002ae298835501d\
                  80200f05753de0edf0&quot;,
        &quot;vout&quot; : 1,
        &quot;address&quot; : &quot;mvbnrCX3bg1cDRUu8pkecrvP6vQkSLDSou&quot;,
        &quot;account&quot; : &quot;&quot;,
        &quot;scriptPubKey&quot; : &quot;76a914a57414e5ffae9ef5074bacbe10a320bb\
                          2614e1f388ac&quot;,
        &quot;amount&quot; : 10.00000000,
        &quot;confirmations&quot; : 1,
        &quot;spendable&quot; : true,
        &quot;solvable&quot; : true
    },
    {
        &quot;txid&quot; : &quot;3f4fa19803dec4d6a84fae3821da7ac7577080ef754512\
                  94e71f9b20e0ab1e7b&quot;,
        &quot;vout&quot; : 0,
        &quot;address&quot; : &quot;mwJTL1dZG8BAP6X7Be3CNNcuVKi7Qqt7Gk&quot;,
        &quot;scriptPubKey&quot; : &quot;210260a275cccf0f4b106220725be516adba27\
                          52db1bec8c5b7174c89c4c07891f88ac&quot;,
        &quot;amount&quot; : 50.00000000,
        &quot;confirmations&quot; : 101,
        &quot;spendable&quot; : true,
        &quot;solvable&quot; : true
    }
]
</code></pre>


<pre><code>
&gt; UTXO_TXID=3f4fa19803dec4d6a84fae3821da7ac7577080ef75451294e71f[...]
&gt; UTXO_VOUT=0
</code></pre>

</div>

<p>Re-run <code>listunspent</code>. We now have three UTXOs: the two transactions we
created before plus the coinbase transaction from block #2. We save the
txid and output index number (vout) of that coinbase UTXO to shell
variables.</p>
<pre><code>&gt; bitcoin-cli -regtest getnewaddress
mz6KvC4aoUeo6wSxtiVQTo7FDwPnkp6URG

&gt; NEW_ADDRESS=mz6KvC4aoUeo6wSxtiVQTo7FDwPnkp6URG
</code></pre>
<p>Get a new address to use in the raw transaction.</p>
<pre><code>### Outputs - inputs = transaction fee, so always double-check your math!
&gt; bitcoin-cli -regtest createrawtransaction '''
    [
      {
        &quot;txid&quot;: &quot;'$UTXO_TXID'&quot;,
        &quot;vout&quot;: '$UTXO_VOUT'
      }
    ]
    ''' '''
    {
      &quot;'$NEW_ADDRESS'&quot;: 49.9999
    }'''
01000000017b1eabe0209b1fe794124575ef807057c77ada2138ae4fa8d6c4de\
0398a14f3f0000000000ffffffff01f0ca052a010000001976a914cbc20a7664\
f2f69e5355aa427045bc15e7c6c77288ac00000000

&gt; RAW_TX=01000000017b1eabe0209b1fe794124575ef807057c77ada2138ae4[...]
</code></pre>
<p>Using two arguments to the <code>createrawtransaction</code> RPC, we create a new
raw format transaction. The first argument (a JSON array) references
the txid of the coinbase transaction from block #2 and the index
number (0) of the output from that transaction we want to spend. The
second argument (a JSON object) creates the output with the address
(public key hash) and number of bitcoins we want to transfer.
We save the resulting raw format transaction to a shell variable.</p>
<p><img alt="Warning icon" src="/img/icons/icon_warning.svg?{{site.time | date: '%s'}}" />
 <strong>Warning:</strong> <code>createrawtransaction</code> does not automatically create change
outputs, so you can easily accidentally pay a large transaction fee. In
this example, our input had 50.0000 bitcoins and our output
(<code>$NEW_ADDRESS</code>) is being paid 49.9999 bitcoins, so the transaction will
include a fee of 0.0001 bitcoins. If we had paid <code>$NEW_ADDRESS</code> only 10
bitcoins with no other changes to this transaction, the transaction fee
would be a whopping 40 bitcoins. See the Complex Raw Transaction
subsection below for how to create a transaction with multiple outputs so you
can send the change back to yourself.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest decoderawtransaction $RAW_TX
</code></pre>


<pre><code>{
    &quot;txid&quot; : &quot;c80b343d2ce2b5d829c2de9854c7c8d423c0e33bda264c4013\
              8d834aab4c0638&quot;,
    &quot;hash&quot; : &quot;c80b343d2ce2b5d829c2de9854c7c8d423c0e33bda264c40138d834aab4c0638&quot;,
    &quot;size&quot; : 85,
    &quot;vsize&quot; : 85,       
    &quot;version&quot; : 1,
    &quot;locktime&quot; : 0,
    &quot;vin&quot; : [
        {
            &quot;txid&quot; : &quot;3f4fa19803dec4d6a84fae3821da7ac7577080ef75\
                      451294e71f9b20e0ab1e7b&quot;,
            &quot;vout&quot; : 0,
            &quot;scriptSig&quot; : {
                &quot;asm&quot; : &quot;&quot;,
                &quot;hex&quot; : &quot;&quot;
            },
            &quot;sequence&quot; : 4294967295
        }
    ],
    &quot;vout&quot; : [
        {
            &quot;value&quot; : 49.99990000,
            &quot;n&quot; : 0,
            &quot;scriptPubKey&quot; : {
                &quot;asm&quot; : &quot;OP_DUP OP_HASH160 cbc20a7664f2f69e5355a\
                         a427045bc15e7c6c772 OP_EQUALVERIFY OP_CHECKSIG&quot;,
                &quot;hex&quot; : &quot;76a914cbc20a7664f2f69e5355aa427045bc15e\
                         7c6c77288ac&quot;,
                &quot;reqSigs&quot; : 1,
                &quot;type&quot; : &quot;pubkeyhash&quot;,
                &quot;addresses&quot; : [
                    &quot;mz6KvC4aoUeo6wSxtiVQTo7FDwPnkp6URG&quot;
                ]
            }
        }
    ]
}
</code></pre>

</div>

<p>Use the <code>decoderawtransaction</code> RPC to see exactly what the transaction
we just created does.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest signrawtransaction $RAW_TX
</code></pre>


<pre><code>{
    &quot;hex&quot; : &quot;01000000017b1eabe0209b1fe794124575ef807057c77ada213\
             8ae4fa8d6c4de0398a14f3f00000000494830450221008949f0\
             cb400094ad2b5eb399d59d01c14d73d8fe6e96df1a7150deb38\
             8ab8935022079656090d7f6bac4c9a94e0aad311a4268e082a7\
             25f8aeae0573fb12ff866a5f01ffffffff01f0ca052a0100000\
             01976a914cbc20a7664f2f69e5355aa427045bc15e7c6c77288\
             ac00000000&quot;,
    &quot;complete&quot; : true
}
</code></pre>


<pre><code>
&gt; SIGNED_RAW_TX=01000000017b1eabe0209b1fe794124575ef807057c77ada[...]
</code></pre>

</div>

<p>Use the <code>signrawtransaction</code> RPC to sign the transaction created by
<code>createrawtransaction</code> and save the returned "hex" raw format signed
transaction to a shell variable. </p>
<p>Even though the transaction is now complete, the Bitcoin Core node we're
connected to doesn't know anything about the transaction, nor does any
other part of the network. We've created a spend, but we haven't
actually spent anything because we could simply unset the
<code>$SIGNED_RAW_TX</code> variable to eliminate the transaction.</p>
<pre><code>&gt; bitcoin-cli -regtest sendrawtransaction $SIGNED_RAW_TX
c7736a0a0046d5a8cc61c8c3c2821d4d7517f5de2bc66a966011aaa79965ffba
</code></pre>
<p>Send the signed transaction to the connected node using the
<code>sendrawtransaction</code> RPC. After accepting the transaction, the node
would usually then broadcast it to other peers, but we're not currently
connected to other peers because we started in regtest mode.</p>
<pre><code>&gt; bitcoin-cli -regtest generate 1

&gt; unset UTXO_TXID UTXO_VOUT NEW_ADDRESS RAW_TX SIGNED_RAW_TX
</code></pre>
<p>Generate a block to confirm the transaction and clear our shell
variables.</p>
<h5 id="complex-raw-transaction">Complex Raw Transaction<a class="headerlink" href="#complex-raw-transaction" title="Permanent link"></a></h5>
<p>In this example, we'll create a transaction with two inputs and two
outputs.  We'll sign each of the inputs separately, as might happen if
the two inputs belonged to different people who agreed to create a
transaction together (such as a CoinJoin transaction).</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest listunspent
</code></pre>


<pre><code>[
    {
        &quot;txid&quot; : &quot;263c018582731ff54dc72c7d67e858c002ae298835501d\
                  80200f05753de0edf0&quot;,
        &quot;vout&quot; : 0,
        &quot;address&quot; : &quot;muhtvdmsnbQEPFuEmxcChX58fGvXaaUoVt&quot;,
        &quot;scriptPubKey&quot; : &quot;76a9149ba386253ea698158b6d34802bb9b550\
                          f5ce36dd88ac&quot;,
        &quot;amount&quot; : 40.00000000,
        &quot;confirmations&quot; : 2,
        &quot;spendable&quot; : true,
        &quot;solvable&quot; : true
    },
    {
        &quot;txid&quot; : &quot;263c018582731ff54dc72c7d67e858c002ae298835501d\
                  80200f05753de0edf0&quot;,
        &quot;vout&quot; : 1,
        &quot;address&quot; : &quot;mvbnrCX3bg1cDRUu8pkecrvP6vQkSLDSou&quot;,
        &quot;account&quot; : &quot;&quot;,
        &quot;scriptPubKey&quot; : &quot;76a914a57414e5ffae9ef5074bacbe10a320bb\
                          2614e1f388ac&quot;,
        &quot;amount&quot; : 10.00000000,
        &quot;confirmations&quot; : 2,
        &quot;spendable&quot; : true,
        &quot;solvable&quot; : true
    },
    {
        &quot;txid&quot; : &quot;78203a8f6b529693759e1917a1b9f05670d036fbb12911\
                  0ed26be6a36de827f3&quot;,
        &quot;vout&quot; : 0,
        &quot;address&quot; : &quot;n2KprMQm4z2vmZnPMENfbp2P1LLdAEFRjS&quot;,
        &quot;scriptPubKey&quot; : &quot;210229688a74abd0d5ad3b06ddff36fa9cd8ed\
                          d181d97b9489a6adc40431fb56e1d8ac&quot;,
        &quot;amount&quot; : 50.00000000,
        &quot;confirmations&quot; : 101,
        &quot;spendable&quot; : true,
        &quot;solvable&quot; : true
    },
    {
        &quot;txid&quot; : &quot;c7736a0a0046d5a8cc61c8c3c2821d4d7517f5de2bc66a\
                  966011aaa79965ffba&quot;,
        &quot;vout&quot; : 0,
        &quot;address&quot; : &quot;mz6KvC4aoUeo6wSxtiVQTo7FDwPnkp6URG&quot;,
        &quot;account&quot; : &quot;&quot;,
        &quot;scriptPubKey&quot; : &quot;76a914cbc20a7664f2f69e5355aa427045bc15\
                          e7c6c77288ac&quot;,
        &quot;amount&quot; : 49.99990000,
        &quot;confirmations&quot; : 1,
        &quot;spendable&quot; : true,
        &quot;solvable&quot; : true
    }
]
</code></pre>


<pre><code>
&gt; UTXO1_TXID=78203a8f6b529693759e1917a1b9f05670d036fbb129110ed26[...]
&gt; UTXO1_VOUT=0
&gt; UTXO1_ADDRESS=n2KprMQm4z2vmZnPMENfbp2P1LLdAEFRjS

&gt; UTXO2_TXID=263c018582731ff54dc72c7d67e858c002ae298835501d80200[...]
&gt; UTXO2_VOUT=0
&gt; UTXO2_ADDRESS=muhtvdmsnbQEPFuEmxcChX58fGvXaaUoVt
</code></pre>

</div>

<p>For our two inputs, we select two UTXOs by placing the txid and output
index numbers (vouts) in shell variables.  We also save the addresses
corresponding to the public keys (hashed or unhashed) used in those
transactions. We need the addresses so we can get the corresponding
private keys from our wallet.</p>
<pre><code>&gt; bitcoin-cli -regtest dumpprivkey $UTXO1_ADDRESS
cSp57iWuu5APuzrPGyGc4PGUeCg23PjenZPBPoUs24HtJawccHPm

&gt; bitcoin-cli -regtest dumpprivkey $UTXO2_ADDRESS
cT26DX6Ctco7pxaUptJujRfbMS2PJvdqiSMaGaoSktHyon8kQUSg

&gt; UTXO1_PRIVATE_KEY=cSp57iWuu5APuzrPGyGc4PGUeCg23PjenZPBPoUs24Ht[...]

&gt; UTXO2_PRIVATE_KEY=cT26DX6Ctco7pxaUptJujRfbMS2PJvdqiSMaGaoSktHy[...]
</code></pre>
<p>Use the <code>dumpprivkey</code> RPC to get the private keys corresponding to the
public keys used in the two UTXOs we will be spending.  We need
the private keys so we can sign each of the inputs separately.</p>
<p><img alt="Warning icon" src="/img/icons/icon_warning.svg?{{site.time | date: '%s'}}" />
 <strong>Warning:</strong> Users should never manually manage private keys on mainnet.
As dangerous as raw transactions are (see warnings above), making a
mistake with a private key can be much worse---as in the case of a HD
wallet [cross-generational key compromise][devguide hardened keys].
These examples are to help you learn, not for you to emulate on
mainnet.</p>
<pre><code>&gt; bitcoin-cli -regtest getnewaddress
n4puhBEeEWD2VvjdRC9kQuX2abKxSCMNqN
&gt; bitcoin-cli -regtest getnewaddress
n4LWXU59yM5MzQev7Jx7VNeq1BqZ85ZbLj

&gt; NEW_ADDRESS1=n4puhBEeEWD2VvjdRC9kQuX2abKxSCMNqN
&gt; NEW_ADDRESS2=n4LWXU59yM5MzQev7Jx7VNeq1BqZ85ZbLj
</code></pre>
<p>For our two outputs, get two new addresses.</p>
<pre><code>### Outputs - inputs = transaction fee, so always double-check your math!
&gt; bitcoin-cli -regtest createrawtransaction '''
    [
      {
        &quot;txid&quot;: &quot;'$UTXO1_TXID'&quot;, 
        &quot;vout&quot;: '$UTXO1_VOUT'
      }, 
      {
        &quot;txid&quot;: &quot;'$UTXO2_TXID'&quot;,
        &quot;vout&quot;: '$UTXO2_VOUT'
      }
    ]
    ''' '''
    {
      &quot;'$NEW_ADDRESS1'&quot;: 79.9999, 
      &quot;'$NEW_ADDRESS2'&quot;: 10 
    }'''
0100000002f327e86da3e66bd20e1129b1fb36d07056f0b9a117199e75939652\
6b8f3a20780000000000fffffffff0ede03d75050f20801d50358829ae02c058\
e8677d2cc74df51f738285013c260000000000ffffffff02f028d6dc01000000\
1976a914ffb035781c3c69e076d48b60c3d38592e7ce06a788ac00ca9a3b0000\
00001976a914fa5139067622fd7e1e722a05c17c2bb7d5fd6df088ac00000000

&gt; RAW_TX=0100000002f327e86da3e66bd20e1129b1fb36d07056f0b9a117199[...]
</code></pre>
<p>Create the raw transaction using <code>createrawtransaction</code> much the same as
before, except now we have two inputs and two outputs.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest signrawtransaction $RAW_TX '[]' '''
    [
      &quot;'$UTXO1_PRIVATE_KEY'&quot;
    ]'''
</code></pre>


<pre><code>{
    &quot;hex&quot; : &quot;0100000002f327e86da3e66bd20e1129b1fb36d07056f0b9a11\
             7199e759396526b8f3a20780000000049483045022100fce442\
             ec52aa2792efc27fd3ad0eaf7fa69f097fdcefab017ea56d179\
             9b10b2102207a6ae3eb61e11ffaba0453f173d1792f1b7bb8e7\
             422ea945101d68535c4b474801fffffffff0ede03d75050f208\
             01d50358829ae02c058e8677d2cc74df51f738285013c260000\
             000000ffffffff02f028d6dc010000001976a914ffb035781c3\
             c69e076d48b60c3d38592e7ce06a788ac00ca9a3b0000000019\
             76a914fa5139067622fd7e1e722a05c17c2bb7d5fd6df088ac0\
             0000000&quot;,
    &quot;complete&quot; : false
    &quot;errors&quot;: [
    {
      &quot;txid&quot;: &quot;c53f8f5ac0b6b10cdc77f543718eb3880fee6cf9b5e0cbf4edb2a59c0fae09a4&quot;,
      &quot;vout&quot;: 0,
      &quot;scriptSig&quot;: &quot;&quot;,
      &quot;sequence&quot;: 4294967295,
      &quot;error&quot;: &quot;Operation not valid with the current stack size&quot;
    }
  ]
}
</code></pre>


<pre><code>
&gt; PARTLY_SIGNED_RAW_TX=0100000002f327e86da3e66bd20e1129b1fb36d07[...]
</code></pre>

</div>

<p>Signing the raw transaction with <code>signrawtransaction</code> gets more
complicated as we now have three arguments:</p>
<ol>
<li>
<p>The unsigned raw transaction.</p>
</li>
<li>
<p>An empty array. We don't do anything with this argument in this
   operation, but some valid JSON must be provided to get access to the
   later positional arguments.</p>
</li>
<li>
<p>The private key we want to use to sign one of the inputs.</p>
</li>
</ol>
<p>The result is a raw transaction with only one input signed; the fact
that the transaction isn't fully signed is indicated by value of the
<code>complete</code> JSON field.  We save the incomplete, partly-signed raw
transaction hex to a shell variable.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest signrawtransaction $PARTLY_SIGNED_RAW_TX '[]' '''
    [
      &quot;'$UTXO2_PRIVATE_KEY'&quot;
    ]'''
</code></pre>


<pre><code>{
    &quot;hex&quot; : &quot;0100000002f327e86da3e66bd20e1129b1fb36d07056f0b9a11\
             7199e759396526b8f3a20780000000049483045022100fce442\
             ec52aa2792efc27fd3ad0eaf7fa69f097fdcefab017ea56d179\
             9b10b2102207a6ae3eb61e11ffaba0453f173d1792f1b7bb8e7\
             422ea945101d68535c4b474801fffffffff0ede03d75050f208\
             01d50358829ae02c058e8677d2cc74df51f738285013c260000\
             00006b483045022100b77f935ff366a6f3c2fdeb83589c79026\
             5d43b3d2cf5e5f0047da56c36de75f40220707ceda75d8dcf2c\
             caebc506f7293c3dcb910554560763d7659fb202f8ec324b012\
             102240d7d3c7aad57b68aa0178f4c56f997d1bfab2ded3c2f94\
             27686017c603a6d6ffffffff02f028d6dc010000001976a914f\
             fb035781c3c69e076d48b60c3d38592e7ce06a788ac00ca9a3b\
             000000001976a914fa5139067622fd7e1e722a05c17c2bb7d5f\
             d6df088ac00000000&quot;,
    &quot;complete&quot; : true
}
</code></pre>

</div>

<p>To sign the second input, we repeat the process we used to sign the
first input using the second private key. Now that both inputs are
signed, the <code>complete</code> result is <em>true</em>.</p>
<pre><code>&gt; unset PARTLY_SIGNED_RAW_TX RAW_TX NEW_ADDRESS1 [...]
</code></pre>
<p>Clean up the shell variables used. Unlike previous subsections, we're
not going to send this transaction to the connected node with
<code>sendrawtransaction</code>. This will allow us to illustrate in the Offline
Signing subsection below how to spend a transaction which is not yet in
the block chain or memory pool.</p>
<h5 id="offline-signing">Offline Signing<a class="headerlink" href="#offline-signing" title="Permanent link"></a></h5>
<p>We will now spend the transaction created in the Complex Raw Transaction
subsection above without sending it to the local node first. This is the
same basic process used by wallet programs for offline
signing---which generally means signing a transaction without access
to the current UTXO set.</p>
<p>Offline signing is safe. However, in this example we will also be
spending an output which is not part of the block chain because the
transaction containing it has never been broadcast. That can be unsafe:</p>
<p><img alt="Warning icon" src="/img/icons/icon_warning.svg?{{site.time | date: '%s'}}" />
 <strong>Warning:</strong> Transactions which spend outputs from unconfirmed
transactions are vulnerable to transaction malleability. Be sure to read
about transaction malleability and adopt good practices before spending
unconfirmed transactions on mainnet.</p>
<pre><code>&gt; OLD_SIGNED_RAW_TX=0100000002f327e86da3e66bd20e1129b1fb36d07056\
      f0b9a117199e759396526b8f3a20780000000049483045022100fce442\
      ec52aa2792efc27fd3ad0eaf7fa69f097fdcefab017ea56d1799b10b21\
      02207a6ae3eb61e11ffaba0453f173d1792f1b7bb8e7422ea945101d68\
      535c4b474801fffffffff0ede03d75050f20801d50358829ae02c058e8\
      677d2cc74df51f738285013c26000000006b483045022100b77f935ff3\
      66a6f3c2fdeb83589c790265d43b3d2cf5e5f0047da56c36de75f40220\
      707ceda75d8dcf2ccaebc506f7293c3dcb910554560763d7659fb202f8\
      ec324b012102240d7d3c7aad57b68aa0178f4c56f997d1bfab2ded3c2f\
      9427686017c603a6d6ffffffff02f028d6dc010000001976a914ffb035\
      781c3c69e076d48b60c3d38592e7ce06a788ac00ca9a3b000000001976\
      a914fa5139067622fd7e1e722a05c17c2bb7d5fd6df088ac00000000
</code></pre>
<p>Put the previously signed (but not sent) transaction into a shell
variable.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest decoderawtransaction $OLD_SIGNED_RAW_TX
</code></pre>


<pre><code>{
    &quot;txid&quot; : &quot;682cad881df69cb9df8f0c996ce96ecad758357ded2da03bad\
              40cf18ffbb8e09&quot;,
    &quot;hash&quot; : &quot;682cad881df69cb9df8f0c996ce96ecad758357ded2da03bad40cf18ffbb8e09&quot;,
    &quot;size&quot; : 340,
    &quot;vsize&quot; : 340,
    &quot;version&quot; : 1,
    &quot;locktime&quot; : 0,
    &quot;vin&quot; : [
        {
            &quot;txid&quot; : &quot;78203a8f6b529693759e1917a1b9f05670d036fbb1\
                      29110ed26be6a36de827f3&quot;,
            &quot;vout&quot; : 0,
            &quot;scriptSig&quot; : {
                &quot;asm&quot; : &quot;3045022100fce442ec52aa2792efc27fd3ad0ea\
                         f7fa69f097fdcefab017ea56d1799b10b210220\
                         7a6ae3eb61e11ffaba0453f173d1792f1b7bb8e\
                         7422ea945101d68535c4b474801&quot;,
                &quot;hex&quot; : &quot;483045022100FCE442ec52aa2792efc27fd3ad0\
                         eaf7fa69f097fdcefab017ea56d1799b10b2102\
                         207a6ae3eb61e11ffaba0453f173d1792f1b7bb\
                         8e7422ea945101d68535c4b474801&quot;
            },
            &quot;sequence&quot; : 4294967295
        },
        {
            &quot;txid&quot; : &quot;263c018582731ff54dc72c7d67e858c002ae298835\
                      501d80200f05753de0edf0&quot;,
            &quot;vout&quot; : 0,
            &quot;scriptSig&quot; : {
                &quot;asm&quot; : &quot;3045022100b77f935ff366a6f3c2fdeb83589c7\
                         90265d43b3d2cf5e5f0047da56c36de75f40220\
                         707ceda75d8dcf2ccaebc506f7293c3dcb91055\
                         4560763d7659fb202f8ec324b01
                         02240d7d3c7aad57b68aa0178f4c56f997d1bfa\
                         b2ded3c2f9427686017c603a6d6&quot;,
                &quot;hex&quot; : &quot;483045022100b77f935ff366a6f3c2fdeb83589\
                         c790265d43b3d2cf5e5f0047da56c36de75f402\
                         20707ceda75d8dcf2ccaebc506f7293c3dcb910\
                         554560763d7659fb202f8ec324b012102240d7d\
                         3c7aad57b68aa0178f4c56f997d1bfab2ded3c2\
                         f9427686017c603a6d6&quot;
            },
            &quot;sequence&quot; : 4294967295
        }
    ],
    &quot;vout&quot; : [
        {
            &quot;value&quot; : 79.99990000,
            &quot;n&quot; : 0,
            &quot;scriptPubKey&quot; : {
                &quot;asm&quot; : &quot;OP_DUP OP_HASH160 ffb035781c3c69e076d48\
                         b60c3d38592e7ce06a7 OP_EQUALVERIFY OP_CHECKSIG&quot;,
                &quot;hex&quot; : &quot;76a914ffb035781c3c69e076d48b60c3d38592e\
                         7ce06a788ac&quot;,
                &quot;reqSigs&quot; : 1,
                &quot;type&quot; : &quot;pubkeyhash&quot;,
                &quot;addresses&quot; : [
                    &quot;n4puhBEeEWD2VvjdRC9kQuX2abKxSCMNqN&quot;
                ]
            }
        },
        {
            &quot;value&quot; : 10.00000000,
            &quot;n&quot; : 1,
            &quot;scriptPubKey&quot; : {
                &quot;asm&quot; : &quot;OP_DUP OP_HASH160 fa5139067622fd7e1e722\
                         a05c17c2bb7d5fd6df0 OP_EQUALVERIFY OP_CHECKSIG&quot;,
                &quot;hex&quot; : &quot;76a914fa5139067622fd7e1e722a05c17c2bb7d\
                         5fd6df088ac&quot;,
                &quot;reqSigs&quot; : 1,
                &quot;type&quot; : &quot;pubkeyhash&quot;,
                &quot;addresses&quot; : [
                    &quot;n4LWXU59yM5MzQev7Jx7VNeq1BqZ85ZbLj&quot;
                ]
            }
        }
    ]
}
</code></pre>


<pre><code>
&gt; UTXO_TXID=682cad881df69cb9df8f0c996ce96ecad758357ded2da03bad40[...]
&gt; UTXO_VOUT=1
&gt; UTXO_VALUE=10.00000000
&gt; UTXO_OUTPUT_SCRIPT=76a914fa5139067622fd7e1e722a05c17c2bb7d5fd6[...]
</code></pre>

</div>

<p>Decode the signed raw transaction so we can get its txid. Also, choose a
specific one of its UTXOs to spend and save that UTXO's output index number
(vout) and hex pubkey script (scriptPubKey) into shell variables.</p>
<pre><code>&gt; bitcoin-cli -regtest getnewaddress
mfdCHEFL2tW9eEUpizk7XLZJcnFM4hrp78

&gt; NEW_ADDRESS=mfdCHEFL2tW9eEUpizk7XLZJcnFM4hrp78
</code></pre>
<p>Get a new address to spend the satoshis to.</p>
<pre><code>### Outputs - inputs = transaction fee, so always double-check your math!
&gt; bitcoin-cli -regtest createrawtransaction '''
    [
      {
        &quot;txid&quot;: &quot;'$UTXO_TXID'&quot;,
        &quot;vout&quot;: '$UTXO_VOUT'
      }
    ]
    ''' '''
    {
      &quot;'$NEW_ADDRESS'&quot;: 9.9999
    }'''
0100000001098ebbff18cf40ad3ba02ded7d3558d7ca6ee96c990c8fdfb99cf6\
1d88ad2c680100000000ffffffff01f0a29a3b000000001976a914012e2ba6a0\
51c033b03d712ca2ea00a35eac1e7988ac00000000

&gt; RAW_TX=0100000001098ebbff18cf40ad3ba02ded7d3558d7ca6ee96c990c8[...]
</code></pre>
<p>Create the raw transaction the same way we've done in the previous
subsections.</p>
<div markdown="1" class="multicode">

<pre><code>    &gt; bitcoin-cli -regtest signrawtransaction $RAW_TX
</code></pre>


<pre><code>    {
        &quot;hex&quot; : &quot;0100000001098ebbff18cf40ad3ba02ded7d3558d7ca6ee\
                 96c990c8fdfb99cf61d88ad2c680100000000ffffffff01\
                 f0a29a3b000000001976a914012e2ba6a051c033b03d712\
                 ca2ea00a35eac1e7988ac00000000&quot;,
        &quot;complete&quot; : false
    }
</code></pre>

</div>

<p>Attempt to sign the raw transaction without any special arguments, the
way we successfully signed the the raw transaction in the Simple Raw
Transaction subsection. If you've read the [Transaction section][transaction] of
the guide, you may know why the call fails and leaves the raw
transaction hex unchanged.</p>
<p><img alt="Old Transaction Data Required To Be Signed" src="/img/dev/en-signing-output-to-spend.svg?{{site.time | date: '%s'}}" /></p>
<p>As illustrated above, the data that gets signed includes the txid and
vout from the previous transaction.  That information is included in the
<code>createrawtransaction</code> raw transaction.  But the data that gets signed
also includes the pubkey script from the previous transaction, even
though it doesn't appear in either the unsigned or signed transaction.</p>
<p>In the other raw transaction subsections above, the previous output was
part of the UTXO set known to the wallet, so the wallet was able to use
the txid and output index number to find the previous pubkey script and
insert it automatically.</p>
<p>In this case, you're spending an output which is unknown to the wallet,
so it can't automatically insert the previous pubkey script.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest signrawtransaction $RAW_TX '''
    [
      {
        &quot;txid&quot;: &quot;'$UTXO_TXID'&quot;, 
        &quot;vout&quot;: '$UTXO_VOUT', 
        &quot;scriptPubKey&quot;: &quot;'$UTXO_OUTPUT_SCRIPT'&quot;,
        &quot;value&quot;: '$UTXO_VALUE'
      }
    ]'''
</code></pre>


<pre><code>{
    &quot;hex&quot; : &quot;0100000001098ebbff18cf40ad3ba02ded7d3558d7ca6ee96c9\
             90c8fdfb99cf61d88ad2c68010000006b483045022100c3f92f\
             b74bfa687d76ebe75a654510bb291b8aab6f89ded4fe26777c2\
             eb233ad02207f779ce2a181cc4055cb0362aba7fd7a6f72d5db\
             b9bd863f4faaf47d8d6c4b500121028e4e62d25760709806131\
             b014e2572f7590e70be01f0ef16bfbd51ea5f389d4dffffffff\
             01f0a29a3b000000001976a914012e2ba6a051c033b03d712ca\
             2ea00a35eac1e7988ac00000000&quot;,
    &quot;complete&quot; : true
}
</code></pre>


<pre><code>
&gt; SIGNED_RAW_TX=0100000001098ebbff18cf40ad3ba02ded7d3558d7ca6ee9[...]
</code></pre>

</div>

<p>Successfully sign the transaction by providing the previous pubkey
script and other required input data. </p>
<p>This specific operation is typically what offline signing wallets do.
The online wallet creates the raw transaction and gets the previous
pubkey scripts for all the inputs. The user brings this information to
the offline wallet. After displaying the transaction details to the
user, the offline wallet signs the transaction as we did above. The
user takes the signed transaction back to the online wallet, which
broadcasts it.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest sendrawtransaction $SIGNED_RAW_TX
</code></pre>


<pre><code>{&quot;error&quot;: {&quot;code&quot;:-22,&quot;message&quot;:&quot;TX rejected&quot;}}
</code></pre>

</div>

<p>Attempt to broadcast the second transaction before we've broadcast the
first transaction.  The node rejects this attempt because the second
transaction spends an output which is not a UTXO the node knows about.</p>
<pre><code>&gt; bitcoin-cli -regtest sendrawtransaction $OLD_SIGNED_RAW_TX
682cad881df69cb9df8f0c996ce96ecad758357ded2da03bad40cf18ffbb8e09
&gt; bitcoin-cli -regtest sendrawtransaction $SIGNED_RAW_TX
67d53afa1a8167ca093d30be7fb9dcb8a64a5fdecacec9d93396330c47052c57
</code></pre>
<p>Broadcast the first transaction, which succeeds, and then broadcast the
second transaction---which also now succeeds because the node now sees
the UTXO.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest getrawmempool
</code></pre>


<pre><code>[
    &quot;67d53afa1a8167ca093d30be7fb9dcb8a64a5fdecacec9d93396330c47052c57&quot;,
    &quot;682cad881df69cb9df8f0c996ce96ecad758357ded2da03bad40cf18ffbb8e09&quot;
]
</code></pre>

</div>

<p>We have once again not generated an additional block, so the transactions
above have not yet become part of the regtest block chain.  However, they
are part of the local node's memory pool.</p>
<pre><code>&gt; unset OLD_SIGNED_RAW_TX SIGNED_RAW_TX RAW_TX [...]
</code></pre>
<p>Remove old shell variables. </p>
<h5 id="p2sh-multisig">P2SH Multisig<a class="headerlink" href="#p2sh-multisig" title="Permanent link"></a></h5>
<p>In this subsection, we will create a P2SH multisig address, spend
satoshis to it, and then spend those satoshis from it to another
address.</p>
<p>Creating a multisig address is easy. Multisig outputs have two
parameters, the <em>minimum</em> number of signatures required (<em>m</em>) and the
<em>number</em> of public keys to use to validate those signatures. This is
called m-of-n, and in this case we'll be using 2-of-3.</p>
<pre><code>    &gt; bitcoin-cli -regtest getnewaddress
    mhAXF4Eq7iRyvbYk1mpDVBiGdLP3YbY6Dm
    &gt; bitcoin-cli -regtest getnewaddress
    moaCrnRfP5zzyhW8k65f6Rf2z5QpvJzSKe
    &gt; bitcoin-cli -regtest getnewaddress
    mk2QpYatsKicvFVuTAQLBryyccRXMUaGHP

    &gt; NEW_ADDRESS1=mhAXF4Eq7iRyvbYk1mpDVBiGdLP3YbY6Dm
    &gt; NEW_ADDRESS2=moaCrnRfP5zzyhW8k65f6Rf2z5QpvJzSKe
    &gt; NEW_ADDRESS3=mk2QpYatsKicvFVuTAQLBryyccRXMUaGHP
</code></pre>
<p>Generate three new P2PKH addresses. P2PKH addresses cannot be used with
the multisig redeem script created below. (Hashing each public key is
unnecessary anyway---all the public keys are protected by a hash when
the redeem script is hashed.) However, Bitcoin Core uses addresses as a
way to reference the underlying full (unhashed) public keys it knows
about, so we get the three new addresses above in order to use their
public keys.</p>
<p>Recall from the Guide that the hashed public keys used in addresses
obfuscate the full public key, so you cannot give an address to another
person or device as part of creating a typical multisig output or P2SH multisig
redeem script. You must give them a full public key.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest validateaddress $NEW_ADDRESS3
</code></pre>


<pre><code>{
    &quot;isvalid&quot; : true,
    &quot;address&quot; : &quot;mk2QpYatsKicvFVuTAQLBryyccRXMUaGHP&quot;,
    &quot;scriptPubKey&quot; : &quot;76a9143172b5654f6683c8fb146959d347ce303cae4ca788ac&quot;,
    &quot;ismine&quot; : true,
    &quot;iswatchonly&quot; : false,
    &quot;isscript&quot; : false,
    &quot;pubkey&quot; : &quot;029e03a901b85534ff1e92c43c74431f7ce72046060fcf7a\
                95c37e148f78c77255&quot;,
    &quot;iscompressed&quot; : true,
    &quot;account&quot; : &quot;&quot;
}
</code></pre>


<pre><code>
&gt; NEW_ADDRESS3_PUBLIC_KEY=029e03a901b85534ff1e92c43c74431f7ce720[...]
</code></pre>

</div>

<p>Use the <code>validateaddress</code> RPC to display the full (unhashed) public key
for one of the addresses.  This is the information which will 
actually be included in the multisig redeem script.  This is also the
information you would give another person or device as part of creating
a multisig output or P2SH multisig redeem script.</p>
<p>We save the address returned to a shell variable.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest createmultisig 2 '''
    [
      &quot;'$NEW_ADDRESS1'&quot;,
      &quot;'$NEW_ADDRESS2'&quot;, 
      &quot;'$NEW_ADDRESS3_PUBLIC_KEY'&quot;
    ]'''
</code></pre>


<pre><code>{
    &quot;address&quot; : &quot;2N7NaqSKYQUeM8VNgBy8D9xQQbiA8yiJayk&quot;,
    &quot;redeemScript&quot; : &quot;522103310188e911026cf18c3ce274e0ebb5f95b00\
    7f230d8cb7d09879d96dbeab1aff210243930746e6ed6552e03359db521b\
    088134652905bd2d1541fa9124303a41e95621029e03a901b85534ff1e92\
    c43c74431f7ce72046060fcf7a95c37e148f78c7725553ae&quot;
}
</code></pre>


<pre><code>
&gt; P2SH_ADDRESS=2N7NaqSKYQUeM8VNgBy8D9xQQbiA8yiJayk
&gt; P2SH_REDEEM_SCRIPT=522103310188e911026cf18c3ce274e0ebb5f95b007[...]
</code></pre>

</div>

<p>Use the <code>createmultisig</code> RPC with two arguments, the number (<em>n</em>) of
signatures required and a list of addresses or public keys.  Because
P2PKH addresses can't be used in the multisig redeem script created by this
RPC, the only addresses which can be provided are those belonging to a
public key in the wallet.  In this case, we provide two addresses and
one public key---all of which will be converted to public keys in the
redeem script.</p>
<p>The P2SH address is returned along with the redeem script which must be
provided when we spend satoshis sent to the P2SH address.</p>
<p><img alt="Warning icon" src="/img/icons/icon_warning.svg?{{site.time | date: '%s'}}" />
 <strong>Warning:</strong> You must not lose the redeem script, especially if you
don't have a record of which public keys you used to create the P2SH
multisig address. You need the redeem script to spend any bitcoins sent
to the P2SH address. If you lose the redeem script, you can recreate it
by running the same command above, with the public keys listed in the
same order. However, if you lose both the redeem script and even one of
the public keys, you will never be able to spend satoshis sent to that
P2SH address.</p>
<p>Neither the address nor the redeem script are stored in the wallet when
you use <code>createmultisig</code>. To store them in the wallet, use the
<code>addmultisigaddress</code> RPC instead.  If you add an address to the wallet,
you should also make a new backup.</p>
<pre><code>&gt; bitcoin-cli -regtest sendtoaddress $P2SH_ADDRESS 10.00
7278d7d030f042ebe633732b512bcb31fff14a697675a1fe1884db139876e175

&gt; UTXO_TXID=7278d7d030f042ebe633732b512bcb31fff14a697675a1fe1884[...]
</code></pre>
<p>Paying the P2SH multisig address with Bitcoin Core is as simple as
paying a more common P2PKH address. Here we use the same command (but
different variable) we used in the Simple Spending subsection. As
before, this command automatically selects an UTXO, creates a change
output to a new one of our P2PKH addresses if necessary, and pays a
transaction fee if necessary.</p>
<p>We save that txid to a shell variable as the txid of the UTXO we plan to spend next.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest getrawtransaction $UTXO_TXID 1
</code></pre>


<pre><code>{
    &quot;hex&quot; : &quot;0100000001f0ede03d75050f20801d50358829ae02c058e8677\
             d2cc74df51f738285013c26010000006a47304402203c375959\
             2bf608ab79c01596c4a417f3110dd6eb776270337e575cdafc6\
             99af20220317ef140d596cc255a4067df8125db7f349ad94521\
             2e9264a87fa8d777151937012102a92913b70f9fb15a7ea5c42\
             df44637f0de26e2dad97d6d54957690b94cf2cd05ffffffff01\
             00ca9a3b0000000017a9149af61346ce0aa2dffcf697352b4b7\
             04c84dcbaff8700000000&quot;,
    &quot;txid&quot; : &quot;7278d7d030f042ebe633732b512bcb31fff14a697675a1fe18\
              84db139876e175&quot;,
    &quot;hash&quot; : &quot;7278d7d030f042ebe633732b512bcb31fff14a697675a1fe1884db139876e175&quot;,
    &quot;size&quot; : 189,
    &quot;vsize&quot; : 189,
    &quot;version&quot; : 1,
    &quot;locktime&quot; : 0,
    &quot;vin&quot; : [
        {
            &quot;txid&quot; : &quot;263c018582731ff54dc72c7d67e858c002ae298835\
                      501d80200f05753de0edf0&quot;,
            &quot;vout&quot; : 1,
            &quot;scriptSig&quot; : {
                &quot;asm&quot; : &quot;304402203c3759592bf608ab79c01596c4a417f\
                         3110dd6eb776270337e575cdafc699af2022031\
                         7ef140d596cc255a4067df8125db7f349ad9452\
                         12e9264a87fa8d77715193701
                         02a92913b70f9fb15a7ea5c42df44637f0de26e\
                         2dad97d6d54957690b94cf2cd05&quot;,
                &quot;hex&quot; : &quot;47304402203c3759592bf608ab79c01596c4a41\
                         7f3110dd6eb776270337e575cdafc699af20220\
                         317ef140d596cc255a4067df8125db7f349ad94\
                         5212e9264a87fa8d777151937012102a92913b7\
                         0f9fb15a7ea5c42df44637f0de26e2dad97d6d5\
                         4957690b94cf2cd05&quot;
            },
            &quot;sequence&quot; : 4294967295
        }
    ],
    &quot;vout&quot; : [
        {
            &quot;value&quot; : 10.00000000,
            &quot;n&quot; : 0,
            &quot;scriptPubKey&quot; : {
                &quot;asm&quot; : &quot;OP_HASH160 9af61346ce0aa2dffcf697352b4b\
                704c84dcbaff OP_EQUAL&quot;,
                &quot;hex&quot; : &quot;a9149af61346ce0aa2dffcf697352b4b704c84d\
                         cbaff87&quot;,
                &quot;reqSigs&quot; : 1,
                &quot;type&quot; : &quot;scripthash&quot;,
                &quot;addresses&quot; : [
                    &quot;2N7NaqSKYQUeM8VNgBy8D9xQQbiA8yiJayk&quot;
                ]
            }
        }
    ]
}
</code></pre>


<pre><code>
&gt; UTXO_VOUT=0
&gt; UTXO_OUTPUT_SCRIPT=a9149af61346ce0aa2dffcf697352b4b704c84dcbaff87
</code></pre>

</div>

<p>We use the <code>getrawtransaction</code> RPC with the optional second argument
(<em>true</em>) to get the decoded transaction we just created with
<code>sendtoaddress</code>. We choose one of the outputs to be our UTXO and get
its output index number (vout) and pubkey script (scriptPubKey).</p>
<pre><code>&gt; bitcoin-cli -regtest getnewaddress
mxCNLtKxzgjg8yyNHeuFSXvxCvagkWdfGU

&gt; NEW_ADDRESS4=mxCNLtKxzgjg8yyNHeuFSXvxCvagkWdfGU
</code></pre>
<p>We generate a new P2PKH address to use in the output we're about to
create.</p>
<pre><code>### Outputs - inputs = transaction fee, so always double-check your math!
&gt; bitcoin-cli -regtest createrawtransaction '''
    [
      {
        &quot;txid&quot;: &quot;'$UTXO_TXID'&quot;,
        &quot;vout&quot;: '$UTXO_VOUT'
      }
   ]
   ''' '''
   {
     &quot;'$NEW_ADDRESS4'&quot;: 9.998
   }'''

010000000175e1769813db8418fea17576694af1ff31cb2b512b7333e6eb42f0\
30d0d778720000000000ffffffff01c0bc973b000000001976a914b6f64f5bf3\
e38f25ead28817df7929c06fe847ee88ac00000000

&gt; RAW_TX=010000000175e1769813db8418fea17576694af1ff31cb2b512b733[...]
</code></pre>
<p>We generate the raw transaction the same way we did in the Simple Raw
Transaction subsection.</p>
<pre><code>&gt; bitcoin-cli -regtest dumpprivkey $NEW_ADDRESS1
cVinshabsALz5Wg4tGDiBuqEGq4i6WCKWXRQdM8RFxLbALvNSHw7
&gt; bitcoin-cli -regtest dumpprivkey $NEW_ADDRESS3
cNmbnwwGzEghMMe1vBwH34DFHShEj5bcXD1QpFRPHgG9Mj1xc5hq

&gt; NEW_ADDRESS1_PRIVATE_KEY=cVinshabsALz5Wg4tGDiBuqEGq4i6WCKWXRQd[...]
&gt; NEW_ADDRESS3_PRIVATE_KEY=cNmbnwwGzEghMMe1vBwH34DFHShEj5bcXD1Qp[...]
</code></pre>
<p>We get the private keys for two of the public keys we used to create the
transaction, the same way we got private keys in the Complex Raw
Transaction subsection. Recall that we created a 2-of-3 multisig pubkey script,
so signatures from two private keys are needed.</p>
<p><img alt="Warning icon" src="/img/icons/icon_warning.svg?{{site.time | date: '%s'}}" />
 <strong>Reminder:</strong> Users should never manually manage private keys on
mainnet. See the warning in the [complex raw transaction section][devex
complex raw transaction].</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest signrawtransaction $RAW_TX '''
    [
      {
        &quot;txid&quot;: &quot;'$UTXO_TXID'&quot;, 
        &quot;vout&quot;: '$UTXO_VOUT', 
        &quot;scriptPubKey&quot;: &quot;'$UTXO_OUTPUT_SCRIPT'&quot;, 
        &quot;redeemScript&quot;: &quot;'$P2SH_REDEEM_SCRIPT'&quot;
      }
    ]
    ''' '''
    [
      &quot;'$NEW_ADDRESS1_PRIVATE_KEY'&quot;
    ]'''
</code></pre>


<pre><code>{
    &quot;hex&quot; : &quot;010000000175e1769813db8418fea17576694af1ff31cb2b512\
             b7333e6eb42f030d0d7787200000000b5004830450221008d5e\
             c57d362ff6ef6602e4e756ef1bdeee12bd5c5c72697ef1455b3\
             79c90531002202ef3ea04dfbeda043395e5bc701e4878c15baa\
             b9c6ba5808eb3d04c91f641a0c014c69522103310188e911026\
             cf18c3ce274e0ebb5f95b007f230d8cb7d09879d96dbeab1aff\
             210243930746e6ed6552e03359db521b088134652905bd2d154\
             1fa9124303a41e95621029e03a901b85534ff1e92c43c74431f\
             7ce72046060fcf7a95c37e148f78c7725553aeffffffff01c0b\
             c973b000000001976a914b6f64f5bf3e38f25ead28817df7929\
             c06fe847ee88ac00000000&quot;,
    &quot;complete&quot; : false
}
</code></pre>


<pre><code>
&gt; PARTLY_SIGNED_RAW_TX=010000000175e1769813db8418fea17576694af1f[...]
</code></pre>

</div>

<p>We make the first signature. The input argument (JSON object) takes the
additional redeem script parameter so that it can append the redeem script
to the signature script after the two signatures.</p>
<div markdown="1" class="multicode">

<pre><code>&gt; bitcoin-cli -regtest signrawtransaction $PARTLY_SIGNED_RAW_TX '''
    [
      {
        &quot;txid&quot;: &quot;'$UTXO_TXID'&quot;,
        &quot;vout&quot;: '$UTXO_VOUT',
        &quot;scriptPubKey&quot;: &quot;'$UTXO_OUTPUT_SCRIPT'&quot;, 
        &quot;redeemScript&quot;: &quot;'$P2SH_REDEEM_SCRIPT'&quot;
      }
    ]
    ''' '''
    [
      &quot;'$NEW_ADDRESS3_PRIVATE_KEY'&quot;
    ]'''
</code></pre>


<pre><code>{
    &quot;hex&quot; : &quot;010000000175e1769813db8418fea17576694af1ff31cb2b512\
             b7333e6eb42f030d0d7787200000000fdfd0000483045022100\
             8d5ec57d362ff6ef6602e4e756ef1bdeee12bd5c5c72697ef14\
             55b379c90531002202ef3ea04dfbeda043395e5bc701e4878c1\
             5baab9c6ba5808eb3d04c91f641a0c0147304402200bd8c62b9\
             38e02094021e481b149fd5e366a212cb823187149799a68cfa7\
             652002203b52120c5cf25ceab5f0a6b5cdb8eca0fd2f386316c\
             9721177b75ddca82a4ae8014c69522103310188e911026cf18c\
             3ce274e0ebb5f95b007f230d8cb7d09879d96dbeab1aff21024\
             3930746e6ed6552e03359db521b088134652905bd2d1541fa91\
             24303a41e95621029e03a901b85534ff1e92c43c74431f7ce72\
             046060fcf7a95c37e148f78c7725553aeffffffff01c0bc973b\
             000000001976a914b6f64f5bf3e38f25ead28817df7929c06fe\
             847ee88ac00000000&quot;,
    &quot;complete&quot; : true
}
</code></pre>


<pre><code>
&gt; SIGNED_RAW_TX=010000000175e1769813db8418fea17576694af1ff31cb2b[...]
</code></pre>

</div>

<p>The <code>signrawtransaction</code> call used here is nearly identical to the one
used above.  The only difference is the private key used.  Now that the
two required signatures have been provided, the transaction is marked as
complete.</p>
<pre><code>&gt; bitcoin-cli -regtest sendrawtransaction $SIGNED_RAW_TX
430a4cee3a55efb04cbb8718713cab18dea7f2521039aa660ffb5aae14ff3f50
</code></pre>
<p>We send the transaction spending the P2SH multisig output to the local
node, which accepts it.</p>
<hr />
<ul>
<li><strong>Kauri original title:</strong> Creating Bitcoin Transactions</li>
<li><strong>Kauri original link:</strong> https://kauri.io/creating-bitcoin-transactions/ef9245af2bf94699be53e0a9c41393a4/a</li>
<li><strong>Kauri original author:</strong> Kauri Team (@kauri)</li>
<li><strong>Kauri original Publication date:</strong> 2019-05-28</li>
<li><strong>Kauri original tags:</strong> bitcoin</li>
<li><strong>Kauri original hash:</strong> QmcMhVTePyJnM4q6G2NHMn7uJkeGkssFkuv1un199UmHju</li>
<li><strong>Kauri original checkpoint:</strong> QmZSRFGq9bnBLosiVwSTANrDR9YdXbWkwG71aw35jAjyLo</li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../bitcoin-contract-scripts/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../bitcoin-contract-scripts/" class="btn btn-xs btn-link">
        Bitcoin Contract Scripts
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../bitcoin-blockchain-overview/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../bitcoin-blockchain-overview/" class="btn btn-xs btn-link">
        Bitcoin Blockchain Overview
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
      <p>
        <a href="https://github.com/kauri-io/archive/edit/main/docs/collections/Bitcoin/creating-bitcoin-transactions.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>