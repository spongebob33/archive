<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://kauri.io/collections/Kotlin%20%E2%9D%A4%20Web3/how-to-achieve-user-authentication-by-web3-wallet/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>How To Achieve User Authentication By Web3 Wallet Using Spring Security, JWTs, Web3j & Kotlin - kauri.io</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "How To Achieve User Authentication By Web3 Wallet Using Spring Security, JWTs, Web3j &amp; Kotlin", url: "#_top", children: [
              {title: "How Does This Work?", url: "#how-does-this-work" },
              {title: "Necessities", url: "#necessities" },
              {title: "Spring Security Configuration", url: "#spring-security-configuration" },
              {title: "Controller Actions", url: "#controller-actions" },
              {title: "Spring Security Things", url: "#spring-security-things" },
              {title: "Demonstrative Frontend", url: "#demonstrative-frontend" },
              {title: "How To Run", url: "#how-to-run" },
              {title: "Special Thanks", url: "#special-thanks" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-172017815-1', 'kauri.io');
        ga('send', 'pageview');
    </script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h1 id="how-to-achieve-user-authentication-by-web3-wallet-using-spring-security-jwts-web3j-kotlin">How To Achieve User Authentication By Web3 Wallet Using Spring Security, JWTs, Web3j &amp; Kotlin<a class="headerlink" href="#how-to-achieve-user-authentication-by-web3-wallet-using-spring-security-jwts-web3j-kotlin" title="Permanent link"></a></h1>
<p><img alt="" src="https://ipfs.infura.io/ipfs/QmYk4fGCrdGiv98vzR6BfbCpiLZdaZd3QJy5Lfq73qpzXD" /></p>
<p>One of the greatest things that a web3 enabled browser gives us is saying goodbye to our primal ways of authenticating users with a username &amp; password combination. </p>
<p>If you're looking to authenticate users using a metamask or any web3 wallet then continue reading this article or simply explore the minimal code here: https://github.com/hshar7/springsecurity-web3-jwt-auth-demo</p>
<p>You can checkout the code and follow along, or start fresh from spring initializer and start fresh, or add whatever you learned here to your existing project!</p>
<h3 id="how-does-this-work">How Does This Work?<a class="headerlink" href="#how-does-this-work" title="Permanent link"></a></h3>
<ol>
<li>The minimal frontend code uses web3js to request the user to sign a message using their web3 enabled browser.</li>
<li>The backend receives the message and makes sure that the person who signed it is the one who called the controller login action by comparing the public key of the user with public key that is extracted from the signed message.</li>
<li>If the login is successful, a jwt is generated by spring security and we send it back to the frontend.</li>
<li>Frontend uses the jwt to call authenticated actions.</li>
</ol>
<h3 id="necessities">Necessities<a class="headerlink" href="#necessities" title="Permanent link"></a></h3>
<p>Be sure to take a look at the pom: https://github.com/hshar7/springsecurity-web3-jwt-auth-demo/blob/master/pom.xml and grab whatever your project is missing.</p>
<p>Add and configure your application.properties similarly to this: https://github.com/hshar7/springsecurity-web3-jwt-auth-demo/blob/master/src/main/resources/application.properties</p>
<h3 id="spring-security-configuration">Spring Security Configuration<a class="headerlink" href="#spring-security-configuration" title="Permanent link"></a></h3>
<p>Killing CORS: https://github.com/hshar7/springsecurity-web3-jwt-auth-demo/blob/master/src/main/kotlin/com/example/demo/config/WebMvcConfig.kt</p>
<p>Adding authenticated paths, adding our simple "NoPasswordEncoder" inline class, and other spring security configurations: https://github.com/hshar7/springsecurity-web3-jwt-auth-demo/blob/master/src/main/kotlin/com/example/demo/config/SecurityConfig.kt</p>
<h3 id="controller-actions">Controller Actions<a class="headerlink" href="#controller-actions" title="Permanent link"></a></h3>
<p>Two actions needed to demonstrate this:
1. Authentication action to generate the jwt and make sure you are the signer of the message.
2. A detail fetching service that requires a live jwt token to demonstrate that we're actually logged in. And we actually fetch who the calling user is using the token which is another nice convenience when building dApps.</p>
<p>Both of these can be found here: https://github.com/hshar7/springsecurity-web3-jwt-auth-demo/blob/master/src/main/kotlin/com/example/demo/controller/UserController.kt</p>
<h3 id="spring-security-things">Spring Security Things<a class="headerlink" href="#spring-security-things" title="Permanent link"></a></h3>
<p>This part of the demo can honestly be copied and pasted but I recommend reading over it to know what's going on. It's basically giving us the @CurrentUser annotation, telling spring security that we're using jwts, and everything in between. It's all here: https://github.com/hshar7/springsecurity-web3-jwt-auth-demo/tree/master/src/main/kotlin/com/example/demo/security</p>
<h3 id="demonstrative-frontend">Demonstrative Frontend<a class="headerlink" href="#demonstrative-frontend" title="Permanent link"></a></h3>
<p>Our frontend is very minimal and only used to call two things:
1. POST /api/user -&gt; To create the user entity in the database for the current public address of the user calling it. And generating a jwt for the user to use for further interactions with the dApp. The jwt gets saved in localStorage.
2. GET /api/userDetails -&gt; To get the details if jwt is valid. To show the unathenticated resposne if the jwt isn't, or if there isn't one in the browser's localStorage.</p>
<p>The frontend's bread and butter is here: https://github.com/hshar7/springsecurity-web3-jwt-auth-demo/blob/master/demo_frontend/src/views/LandingPage/LandingPage.jsx</p>
<h3 id="how-to-run">How To Run<a class="headerlink" href="#how-to-run" title="Permanent link"></a></h3>
<ul>
<li>Frontend: <code>npm install &amp; npm start</code></li>
<li>Backend: I'd just launch the project with intellij but you can also do <code>mvn clean install</code> then run the generated jar file that is in the target folder using <code>java -jar ***</code></li>
</ul>
<h3 id="special-thanks">Special Thanks<a class="headerlink" href="#special-thanks" title="Permanent link"></a></h3>
<p>To Callicoder for this tutorial series that taught me how to do spring security authentication using passwords. https://www.callicoder.com/spring-boot-spring-security-jwt-mysql-react-app-part-1/</p>
<hr />
<ul>
<li><strong>Kauri original title:</strong> How To Achieve User Authentication By Web3 Wallet Using Spring Security, JWTs, Web3j &amp; Kotlin</li>
<li><strong>Kauri original link:</strong> https://kauri.io/how-to-achieve-user-authentication-by-web3-wallet/a7a3198e2673406aa730d41854871e1a/a</li>
<li><strong>Kauri original author:</strong> Hayder Sharhan (@hshar)</li>
<li><strong>Kauri original Publication date:</strong> 2019-08-19</li>
<li><strong>Kauri original tags:</strong> jwt, web3j, kotlin, springboot</li>
<li><strong>Kauri original hash:</strong> QmbBAwBTVkP2ggLEMHZwd8Lm5VcYRgiWXacQiKEJup68Eg</li>
<li><strong>Kauri original checkpoint:</strong> Qmekp5iiDi5N5M4KdtAVGBEJEF3ahMgWYZJqL7s1qmkQ9g</li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../consuming-ethereum-events-to-kotlin-service-using/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../consuming-ethereum-events-to-kotlin-service-using/" class="btn btn-xs btn-link">
        Consuming Ethereum Events To Kotlin Service Using Eventeum
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../simple-kotlin-springboot-dapp-utilizing-web3j/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../simple-kotlin-springboot-dapp-utilizing-web3j/" class="btn btn-xs btn-link">
        Simple Kotlin SpringBoot dApp utilizing web3j
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
      <p>
        <a href="https://github.com/kauri-io/archive/edit/main/docs/collections/Kotlin ❤ Web3/how-to-achieve-user-authentication-by-web3-wallet.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>