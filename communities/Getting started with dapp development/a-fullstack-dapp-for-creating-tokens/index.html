<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://kauri.io/communities/Getting%20started%20with%20dapp%20development/a-fullstack-dapp-for-creating-tokens/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>A fullstack dapp for creating tokens - kauri.io</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "A fullstack dapp for creating tokens", url: "#_top", children: [
              {title: "The smart contract", url: "#the-smart-contract" },
              {title: "The Web app", url: "#the-web-app" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-172017815-1', 'kauri.io');
        ga('send', 'pageview');
    </script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h1 id="a-fullstack-dapp-for-creating-tokens">A fullstack dapp for creating tokens<a class="headerlink" href="#a-fullstack-dapp-for-creating-tokens" title="Permanent link"></a></h1>
<p><img alt="" src="https://ipfs.infura.io/ipfs/QmRoMYkdbHUAZP2WpUvAZzKv7D3u2FKg5U3NXRnLSGK3Uv" /></p>
<blockquote>
<p>This dapp implements the simplest form of a cryptocurrency that uses the ERC-20 standard to define a token you can create and send to others. This tutorial is intended to be followed using the online IDE available at <a href="https://studio.ethereum.org">studio.ethereum.org</a>, and selecting the "Coin" template.</p>
</blockquote>
<p><img alt="Select Coin template" src="https://ipfs.infura.io/ipfs/QmWUTMmZAbbLYUhZv9ZzR9R1Ey2R4xgcxQQoFRoNdBPW85" /></p>
<h3 id="the-smart-contract">The smart contract<a class="headerlink" href="#the-smart-contract" title="Permanent link"></a></h3>
<p>The contract allows only its creator to create new coins (different issuance scheme are possible). Anyone can send coins to each other without a need for registering with a username and password, and all you need is an Ethereum keypair.</p>
<p>The line <code>address public minter;</code> declares a state variable of an <a href="https://solidity.readthedocs.io/en/latest/types.html#address"><code>address</code> type</a>. The <code>address</code> type is a 160-bit value that does not allow any arithmetic operations. It is suitable for storing addresses of contracts, or a hash of the public half of a keypair belonging to <a href="https://solidity.readthedocs.io/en/latest/introduction-to-smart-contracts.html#accounts">external accounts</a>.</p>
<p>The keyword <code>public</code> automatically generates a function that allows you to access the current value of the state variable from outside of the contract. Without this keyword, other contracts have no way to access the variable. The code of the function generated by the compiler is equivalent to the following (ignore <code>external</code> and <code>view</code> for now):</p>
<pre><code>function minter() external view returns (address) { return minter; }
</code></pre>
<p>You could add a function like the above yourself, but you would have a function and a state variable with the same name. This is not necessary, the compiler figures it out for you.</p>
<p>The next line, <code>mapping (address =&gt; uint) public balances;</code> also creates a public state variable, but it is a more complex data type. The <a href="https://solidity.readthedocs.io/en/latest/types.html#mapping-types">mapping</a> type maps addresses to <a href="https://solidity.readthedocs.io/en/latest/types.html#integers">unsigned integers</a>.</p>
<p>You can think of mappings as <a href="https://en.wikipedia.org/wiki/Hash_table">hash tables</a> which are virtually initialized such that every possible key exists from the start and is mapped to a value whose byte-representation is all zeros. It is not possible to obtain a list of all keys of a mapping, nor a list of all values. Record what you added to the mapping, or use it in a context where this is not needed. Even better, keep a list, or use a more suitable data type.</p>
<p>The <a href="https://solidity.readthedocs.io/en/latest/contracts.html#getter-functions">getter function</a> created by the <code>public</code> keyword is more complex in the case of a mapping. It looks like the following::</p>
<pre><code>function balances(address _account) external view returns (uint) {
    return balances[_account];
}
</code></pre>
<p>You can use this function to query the balance of a single account.</p>
<p>The line <code>event Sent(address from, address to, uint amount);</code> declares an "<a href="https://solidity.readthedocs.io/en/latest/contracts.html#events">event</a>", which is emitted in the last line of the function <code>send</code>. Ethereum clients such as web applications can listen for these events emitted on the blockchain without much cost. As soon as the event is emitted, the listener receives the arguments <code>from</code>, <code>to</code> and <code>amount</code>, which makes it possible to track transactions.</p>
<p>The <a href="https://solidity.readthedocs.io/en/v0.5.11/contracts.html#constructor">constructor</a> is a special function run during the creation of the contract, and you cannot call it afterwards. In this case, it permanently stores the address of the person creating the contract. The <code>msg</code> variable (together with <code>tx</code> and <code>block</code>) is a <a href="https://solidity.readthedocs.io/en/v0.5.11/units-and-global-variables.html#special-variables-functions">special global variable</a> that contains properties which allow access to the blockchain. <code>msg.sender</code> is always the address where the current (external) function call came from.</p>
<p>The functions that make up the contract, and that users and contracts can call are <code>mint</code> and <code>send</code>.</p>
<p>The <code>mint</code> function sends an amount of newly created coins to another address. The <a href="https://solidity.readthedocs.io/en/v0.5.11/control-structures.html#assert-and-require">require</a> function call defines conditions that reverts all changes if not met. In this example, <code>require(msg.sender == minter);</code> ensures that only the creator of the contract can call <code>mint</code>, and <code>require(amount &lt; 1e60);</code> ensures a maximum amount of tokens, without which could cause overflow errors in the future.</p>
<p>Anyone can use the <code>send</code> (who already has some of these coins) to send coins to anyone else. If the sender does not have enough coins to send, the <code>require</code> call fails and provides the sender with an appropriate error message string.</p>
<h3 id="the-web-app">The Web app<a class="headerlink" href="#the-web-app" title="Permanent link"></a></h3>
<p>This tutorial doesn't cover the HTML or CSS as it's not web3 specific, aside from the element IDs that the JavaScript manipulates. A lot of the JavaScript code follows standard patterns for object-oriented JavaScript, so this tutorial focuses on the web3js specific parts.</p>
<p>First create an instance of the smart contract, <a href="https://web3js.readthedocs.io/en/v1.2.0/web3-eth-contract.html">passing it as a property</a>, which allows web3js to interact with it.</p>
<pre><code class="language-javascript">function Coin(Contract) {
    this.web3 = null;
    this.instance = null;
    this.Contract = Contract;
}
</code></pre>
<p>Initialize the <code>Coin</code> object and create an instance of the web3js library, passing Metamask as a provider for the contract. The initialization function then defines the interface for the contract using <a href="https://web3js.readthedocs.io/en/v1.2.1/web3-eth-contract.html#new-contract">the web3js contract object</a> and then defines the address of the instance of the contract for the <code>Coin</code> object.</p>
<pre><code class="language-javascript">Coin.prototype.init = function() {

    this.web3 = new Web3(
        (window.web3 &amp;&amp; window.web3.currentProvider) ||
        new Web3.providers.HttpProvider(this.Contract.endpoint));

    var contract_interface = this.web3.eth.contract(this.Contract.abi);

    this.instance = contract_interface.at(this.Contract.address);
};
</code></pre>
<p>Add other JavaScript boilerplate to create the instance of the <code>Coin</code> object defined above, and bind the functions for interacting with the contract to the buttons defined in the HTML:</p>
<pre><code class="language-javascript">Coin.prototype.bindButtons = function() {
    var that = this;

    $(document).on(&quot;click&quot;, &quot;#button-create&quot;, function() {
        that.createTokens();
    });

    $(document).on(&quot;click&quot;, &quot;#button-check&quot;, function() {
        that.showAddressBalance();
    });
}

Coin.prototype.onReady = function() {
    this.bindButtons();
    this.init();
    this.main();
};

var coin = new Coin(Contracts['Coin']);

$(document).ready(function() {
    coin.onReady();
});
</code></pre>
<p>Create the function triggered when someone clicks the "send" button which creates a specified number of new coin tokens and sends them to the address specified. Before doing this, it checks the address and amount are valid using two utility functions we create later. Web3js provides access to functions in the smart contract by accessing the instance of the contract. For example, the function below calls the <code>mint</code> function of the contract to create the tokens with <code>this.instance.mint</code>, passing the variables it needs, waiting for confirmation, or returning an error.</p>
<pre><code class="language-javascript">Coin.prototype.createTokens = function() {
    var that = this;

    var address = $(&quot;#create-address&quot;).val();
    var amount = $(&quot;#create-amount&quot;).val();
    console.log(amount);

    if(!isValidAddress(address)) {
        console.log(&quot;Invalid address&quot;);
        return;
    }

    if(!isValidAmount(amount)) {
        console.log(&quot;Invalid amount&quot;);
        return;
    }

    this.instance.mint(address, amount, { from: window.web3.eth.accounts[0], gas: 100000, gasPrice: 100000, gasLimit: 100000 },
        function(error, txHash) {
            if(error) {
                console.log(error);
            }
            else {
                that.waitForReceipt(txHash, function(receipt) {
                    if(receipt.status) {
                        $(&quot;#create-address&quot;).val(&quot;&quot;);
                        $(&quot;#create-amount&quot;).val(&quot;&quot;);
                    }
                    else {
                        console.log(&quot;error&quot;);
                    }
                });
            }
        }
    )
}
</code></pre>
<p>The <code>waitForReceipt</code> function called above uses the web3js function <a href="https://web3js.readthedocs.io/en/v1.2.1/web3-eth.html?highlight=getTransactionReceipt#gettransactionreceipt"><code>getTransactionReceipt</code></a> to wait for a receipt for the transaction, trying again if the first attempt fails:</p>
<pre><code class="language-javascript">Coin.prototype.waitForReceipt = function(hash, cb) {
    var that = this;

    this.web3.eth.getTransactionReceipt(hash, function(err, receipt) {
        if (err) {
            error(err);
        }
        if (receipt !== null) {
            if (cb) {
                cb(receipt);
            }
        } else {
            window.setTimeout(function() {
                that.waitForReceipt(hash, cb);
            }, 2000);
        }
    });
}
</code></pre>
<p>Create the function called when someone clicks the "Check balance" button. The function takes the address value specified, and checks it is a valid address with the same utility function used earlier. The function then calls the <code>getBalance</code> function which in turn calls the <code>balances</code> function of the instance of the <code>Coin</code> contract, passing the address value to it, and returning the result or an error.</p>
<pre><code class="language-javascript">Coin.prototype.showAddressBalance = function(hash, cb) {
    var that = this;

    var address = $(&quot;#balance-address&quot;).val();

    if(!isValidAddress(address)) {
        console.log(&quot;Invalid address&quot;);
        return;
    }

    this.getBalance(address, function(error, balance) {
        if(error) {
            console.log(error)
        }
        else {
            console.log(balance.toNumber());
                $(&quot;#message&quot;).text(balance.toNumber());
        }
    })
}

Coin.prototype.getBalance = function(address, cb) {
    this.instance.balances(address, function(error, result) {
        cb(error, result);
    })
}
</code></pre>
<p>These are the two utility functions that check for a valid address and amount:</p>
<pre><code class="language-javascript">function isValidAddress(address) {
    return /^(0x)?[0-9a-f]{40}$/i.test(address);
}

function isValidAmount(amount) {
    return amount &gt; 0 &amp;&amp; typeof Number(amount) == 'number';
}
</code></pre>
<p>And that's all the code. To see the dapp in action, click <em>Compile</em>, then <em>Deploy</em> found under the disclosure triangle of the contract file, then open the <em>Preview</em> tab to see the frontend of the dapp.</p>
<hr />
<ul>
<li><strong>Kauri original title:</strong> A fullstack dapp for creating tokens</li>
<li><strong>Kauri original link:</strong> https://kauri.io/a-fullstack-dapp-for-creating-tokens/bdd65d6155a74b8aa52672b46b7230a8/a</li>
<li><strong>Kauri original author:</strong> Chris Ward (@chrischinchilla)</li>
<li><strong>Kauri original Publication date:</strong> 2019-12-06</li>
<li><strong>Kauri original tags:</strong> smart-contract, getting-started, dapp, erc-20, token-standard, solidity</li>
<li><strong>Kauri original hash:</strong> QmeLARWSKm5K65iUUBtjed3tUt7dRRVjt47N1xa14CxjS4</li>
<li><strong>Kauri original checkpoint:</strong> Qmekp5iiDi5N5M4KdtAVGBEJEF3ahMgWYZJqL7s1qmkQ9g</li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../a-fullstack-dapp-for-creating-unique-tradable-tok/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../a-fullstack-dapp-for-creating-unique-tradable-tok/" class="btn btn-xs btn-link">
        A fullstack dapp for creating unique tradable tokens
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../create-a-%22hello-world%22-fullstack-dapp/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../create-a-%22hello-world%22-fullstack-dapp/" class="btn btn-xs btn-link">
        Create a "Hello World" fullstack dapp
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
      <p>
        <a href="https://github.com/kauri-io/archive/edit/main/docs/communities/Getting started with dapp development/a-fullstack-dapp-for-creating-tokens.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>