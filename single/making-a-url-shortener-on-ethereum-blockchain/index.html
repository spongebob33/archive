<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://kauri.io/single/making-a-url-shortener-on-ethereum-blockchain/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Making a URL shortener on Ethereum Blockchain ‚õì - kauri.io</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Making a URL shortener on Ethereum Blockchain \u26d3", url: "#_top", children: [
              {title: "The Product", url: "#the-product" },
              {title: "How it works", url: "#how-it-works" },
              {title: "Technical Challenges", url: "#technical-challenges" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-172017815-1', 'kauri.io');
        ga('send', 'pageview');
    </script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h1 id="making-a-url-shortener-on-ethereum-blockchain">Making a URL shortener on Ethereum Blockchain ‚õì<a class="headerlink" href="#making-a-url-shortener-on-ethereum-blockchain" title="Permanent link">ÔÉÅ</a></h1>
<hr />
<blockquote></blockquote>
<h4 id="the-product">The Product<a class="headerlink" href="#the-product" title="Permanent link">ÔÉÅ</a></h4>
<blockquote class="twitter-tweet" data-align="center" data-conversation="none" data-dnt="true"><p>üîó <a href="https://t.co/Rte4yKrN1q" rel="nofollow">https://t.co/Rte4yKrN1q</a> shutting down is old news. But have you found a replacement? Well, we did! A link shortener that will keep your link stored for a lifetime ... because it's on the blockchain. Check out <a href="http://twitter.com/sauravtom" target="_blank" title="Twitter profile for @sauravtom">@sauravtom</a>'s Ethereum URL shortener at <a href="https://t.co/QhsWph5eOi" rel="nofollow">https://t.co/QhsWph5eOi</a>!</p><p>‚Ää‚Äî‚Ää<a href="https://twitter.com/makersup/status/1069165144150704130">@makersup</a></p></blockquote>

<h3 id="how-it-works">How it works<a class="headerlink" href="#how-it-works" title="Permanent link">ÔÉÅ</a></h3>
<p><img alt="" src="https://ipfs.infura.io/ipfs/QmasWnFCo1WTEu58JV8Sv6LhAzfgXGJvWPLu6xy2wdAdWZ" /></p>
<p>The web app deployed at 
<a href="https://0x.now.sh">0x.now.sh</a>
 , interacts with a smart contract deployed on 
<a href="https://ropsten.etherscan.io/address/0x4b8241f24537d2539d0b310bc074fd68a782e182">Ethereum Ropsten testnet</a>
 . Being on testnet means you can interact with it using free ethers. Get your 
<a href="https://faucet.metamask.io">free ethers here</a>
 .</p>
<blockquote>
<p>0x.now.sh</p>
<p>Ethereum Ropsten testnet</p>
<p>free ethers here</p>
</blockquote>
<h4 id="the-process">The Process<a class="headerlink" href="#the-process" title="Permanent link">ÔÉÅ</a></h4>
<ul>
<li>
<p>Users make a transaction requesting the blockchain to store a URL string.</p>
</li>
<li>
<p>Since it is a transaction that modifies the state of the blockchain, it needs to have some amount of ethers attached to it so that it can be mined to the blockchain by miners.</p>
</li>
<li>
<p>The amount of fee (also called <a href="https://www.cryptocompare.com/coins/guides/what-is-the-gas-in-ethereum/">gas</a> ) is determined by the Metamask chrome extension and displayed in the prompt box.</p>
<blockquote>
<p>gas</p>
</blockquote>
</li>
<li>
<p>There is some waiting time for the transaction to be confirmed (5‚Äì10sec) depending on how busy the blockchain is.</p>
</li>
<li>
<p>The shortened URL is generated. eg <a href="https://0x.now.sh/s?id=23">https://0x.now.sh/s?id=23</a> </p>
<blockquote>
<p>https://0x.now.sh/s?id=23</p>
</blockquote>
</li>
<li>
<p>When the users clicks on the shortened URL another transaction is made requesting the blockchain which URL string is located at the provided reference (in this case 23)</p>
</li>
<li>
<p>Since this transaction is not changing the state of the blockchain, we do not need to pay any ETH this time, the user is seamlessly redirected to the long URL.</p>
</li>
</ul>
<h4 id="the-smartcontract">The SmartContract üìÉ<a class="headerlink" href="#the-smartcontract" title="Permanent link">ÔÉÅ</a></h4>
<pre><code>pragma solidity ^0.4.24;
</code></pre>
<pre><code>contract e0x {
 event LinkVisited(string url, uint linkId);
 event LinkAdded(uint linkId, string url);

 struct LinkTemplate {
  address userAddress;
  string url;
 }

 uint lastLinkId;
 mapping (uint =&gt; LinkTemplate) public linkMapping;

 constructor() public {
  lastLinkId = 0;
 }


 function createNewLink(string url) public returns (uint) {
     lastLinkId++;
  linkMapping[lastLinkId] = LinkTemplate(msg.sender, url);
  emit LinkAdded(lastLinkId, url);
  return lastLinkId;
 }

 modifier linkExists(uint linkId) {
     //link with the given hash does not exist
  if(linkMapping[linkId].userAddress == 0x0000000000000000000000000000000000000000) {
   revert();
  }
  _;
 }

 function getLink(uint linkId) linkExists(linkId) public constant
  returns(
   address,
   string
  ) {
      //emit LinkVisited(linkId, link.url);
      LinkTemplate memory link = linkMapping[linkId];
   return(
      link.userAddress,
      link.url
   );
  }
</code></pre>
<pre><code>event LinkAdded(uint linkId, string url);

 struct LinkTemplate {
  address userAddress;
  string url;
 }

 uint lastLinkId;
 mapping (uint =&gt; LinkTemplate) public linkMapping;

 constructor() public {
  lastLinkId = 0;
 }


 function createNewLink(string url) public returns (uint) {
     lastLinkId++;
  linkMapping[lastLinkId] = LinkTemplate(msg.sender, url);
  emit LinkAdded(lastLinkId, url);
  return lastLinkId;
 }

 modifier linkExists(uint linkId) {
     //link with the given hash does not exist
  if(linkMapping[linkId].userAddress == 0x0000000000000000000000000000000000000000) {
   revert();
  }
  _;
 }

 function getLink(uint linkId) linkExists(linkId) public constant
  returns(
   address,
   string
  ) {
      //emit LinkVisited(link.url,linkId);
      LinkTemplate memory link = linkMapping[linkId];
   return(
       link.userAddress,
       link.url
   );
  }
</code></pre>
<hr />
<h3 id="technical-challenges">Technical Challenges<a class="headerlink" href="#technical-challenges" title="Permanent link">ÔÉÅ</a></h3>
<h4 id="making-the-shortened-urls-accessible-in-all-browsers">Making the shortened URLs accessible in all Browsers<a class="headerlink" href="#making-the-shortened-urls-accessible-in-all-browsers" title="Permanent link">ÔÉÅ</a></h4>
<p>This was quite tricky because interacting with blockchain required the browser to be web3 enabled, and have some wallet installed (metamask or similar). Currently web3 and wallet support is only for Chrome and Firefox on Desktop only.
To solve this, I had to create a wallet on the fly as follows</p>
<pre><code>provider = ethers.getDefaultProvider('ropsten');
wallet = ethers.Wallet.createRandom();
wallet = wallet.connect(provider);
</code></pre>
<p>Shout out to 
<a href="https://github.com/ethers-io/ethers.js/">ethersJS library</a>
 for having support for this.</p>
<blockquote>
<p>ethersJS library</p>
</blockquote>
<h4 id="counting-url-visits">Counting URL visits<a class="headerlink" href="#counting-url-visits" title="Permanent link">ÔÉÅ</a></h4>
<p>The flexibility for using this one all browsers comes at a cost. Each time user clicks on the shortened URL no change is made to the blockchain state, hence it is not possible to determine how many times each link was clicked.
This issues remains unsolved.
The complete source code for this project is on 
<a href="https://github.com/sauravtom/ethereum-url-shortener">Github</a>
 .</p>
<blockquote>
<p>Github
Pull Requests welcome üòÅ</p>
</blockquote>
<hr />
<ul>
<li><strong>Kauri original title:</strong> Making a URL shortener on Ethereum Blockchain ‚õì</li>
<li><strong>Kauri original link:</strong> https://kauri.io/making-a-url-shortener-on-ethereum-blockchain/a7ba00394f414496827730f0ce4aeacd/a</li>
<li><strong>Kauri original author:</strong> sauravtom (@sauravtom)</li>
<li><strong>Kauri original Publication date:</strong> 2018-12-04</li>
<li><strong>Kauri original tags:</strong> none</li>
<li><strong>Kauri original hash:</strong> QmfD4zffz3QRQAfYx5JKnPEtuVCHCH777MUCuRWidpTs1p</li>
<li><strong>Kauri original checkpoint:</strong> QmYRYAA1TRyDiXS6uLXdt6qS8AnW63tqJHYpUQKrdyNz7h</li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../kauri-users-your-input-requested%21/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../kauri-users-your-input-requested%21/" class="btn btn-xs btn-link">
        Kauri Users, your input requested!
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../the-defi-series-an-overview-of-the-ecosystem-and-/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../the-defi-series-an-overview-of-the-ecosystem-and-/" class="btn btn-xs btn-link">
        The DeFi Series‚Ää‚Äî‚ÄäAn overview of the ecosystem and major protocols
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
      <p>
        <a href="https://github.com/kauri-io/archive/edit/main/docs/single/making-a-url-shortener-on-ethereum-blockchain.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>